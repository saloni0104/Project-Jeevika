<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css?family=Barlow&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Organisation SignUp</title>

    <script>
        function yellow(event) {
            event.target.style.borderColor = "#f77f00";
            event.target.placeholder = "";
        }</script>

</head>

<body
    style="background-image: url('images/ngo-signup.jpg');background-repeat: no-repeat;background-position: center;  background-size:cover; background-color:lightsteelblue; ">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="index.html">Navbar</a>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">

            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row" style="margin-top : 10px; margin-bottom:50px;">

            <div class="col-12 col-lg-6">
                <div class="admin">
                    <h1 class="login-signup-title"> Organisation Sign Up</h1>
                    <div>
                        <div id="error"></div>
                    </div>
                    <div>
                        <input id="name1" placeholder="Name" type="text" onfocus="yellow(event)" required>
                    </div>
                    <div>
                        <input id="email1" placeholder="Email" type="email" name="emailaddress" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="phone" placeholder="Phone" type="tel" name="phone" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="address" placeholder="Address" type="text" name="address" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="area" placeholder="Areas Catered" type="text" name="area" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="desc" placeholder="Description" type="text" name="description" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="web" placeholder="Website link" type="text" name="web" onfocus="yellow(event)"
                            required>
                    </div>
                    <div>
                        <input id="pass1" placeholder="Password" type="password" onfocus="yellow(event)" required>
                    </div>
                    <div style=" position:relative;">
                        <input class="login-button" type="submit" value="Signup" id="sub">
                    </div>

                    <div style="padding-top:30px">
                        <a href="ngo-login.html"><b><u>Already have an
                                    account? LogIn!</u></b></a>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script>

        window.onload = function () {
            document.getElementById("sub").addEventListener("click", function (e) {

                var name = document.getElementById("name1").value;
                var email = document.getElementById("email1").value;
                var phone = document.getElementById("phone").value;
                var address = document.getElementById("address").value;
                var areas_catered = document.getElementById("area").value;
                var description = document.getElementById("desc").value;
                var password = document.getElementById("pass1").value;
                var web_link = document.getElementById("web").value;

                let status = [];
                let re = /^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/;

                if (name.length <= 1) {
                    document.getElementById("name1").style.borderColor = "red";
                    document.getElementById("name1").value = "";
                    document.getElementById("name1").placeholder = "Please enter valid name";
                    status.push("false")
                    document.getElementById("name1").classList.add("red");
                } else {
                    status.push("true")
                }
                if (phone.length <= 8) {
                    document.getElementById("phone").style.borderColor = "red";
                    document.getElementById("phone").value = "";
                    document.getElementById("phone").placeholder = "Please enter valid phone";
                    status.push("false")
                    document.getElementById("phone").classList.add("red");
                } else {
                    status.push("true")
                }
                if (address.length <= 1) {
                    document.getElementById("address").style.borderColor = "red";
                    document.getElementById("address").value = "";
                    document.getElementById("address").placeholder = "Please enter valid address";
                    status.push("false")
                    document.getElementById("address").classList.add("red");
                } else {
                    status.push("true")
                }
                if (areas_catered.length <= 1) {
                    document.getElementById("area").style.borderColor = "red";
                    document.getElementById("area").value = "";
                    document.getElementById("area").placeholder = "Please enter valid area";
                    status.push("false")
                    document.getElementById("area").classList.add("red");
                } else {
                    status.push("true")
                }
                if (web_link.length <= 1) {
                    document.getElementById("web").style.borderColor = "red";
                    document.getElementById("web").value = "";
                    document.getElementById("web").placeholder = "Please enter valid website";
                    status.push("false")
                    document.getElementById("web").classList.add("red");
                } else {
                    status.push("true")
                }
                if (description.length <= 1) {
                    document.getElementById("desc").style.borderColor = "red";
                    document.getElementById("desc").value = "";
                    document.getElementById("desc").placeholder = "Please enter valid description";
                    status.push("false")
                    document.getElementById("desc").classList.add("red");
                } else {
                    status.push("true")
                }
                if (re.test(email.trim())) {
                    status.push("true")
                } else {
                    document.getElementById("email1").style.borderColor = "red";
                    document.getElementById("email1").value = "";
                    document.getElementById("email1").placeholder = "Please enter valid email";
                    status.push("false")
                    document.getElementById("email1").classList.add("red");
                }
                var len = password.length;
                if (len <= 6) {
                    status.push("false")
                    document.getElementById("pass1").style.borderColor = "red";
                    document.getElementById("pass1").value = "";
                    document.getElementById("pass1").placeholder = "Please enter valid password";

                } else {
                    status.push("true")
                }
                if (status.includes("false")) {
                    console.log("There was some error while validating")
                    return false
                }
                else {
                    console.log("Validated")
                    document.getElementById("sub").value = "Loading..."
                    fetch("https://crack-corona-hack-backend.herokuapp.com/app/org/signup/", {
                        method: 'POST',
                        headers: new Headers({ 'content-type': 'application/json' }),
                        body: JSON.stringify({
                            email: email,
                            org_name: name,
                            phone_no: phone,
                            address: address,
                            areas_catered: areas_catered,
                            description: description,
                            web_link: web_link,
                            password: password
                        }),
                    })
                        .then(res => {
                            return res.json()
                        })
                        .then(res => {
                            console.log(res)
                            if (res.access_token) {
                                localStorage.setItem("sc_access_token", res.access_token);
                                localStorage.setItem("sc_refresh_token", res.refresh_token);
                                document.getElementById("banner").style.backgroundColor = "green";
                                document.getElementById("banner").style.display = "block";
                                document.getElementById("banner").innerHTML = "User was successfully registered!! Redirecting ..."
                                document.getElementById("banner").classList.add("error");
                                document.getElementById("sub").value = "Register"
                                setTimeout(() => {
                                    window.location.href = "Login.html";
                                }, 2500)
                            } else if (res.err = "User already exist") {
                                document.getElementById("banner").style.backgroundColor = "red";
                                document.getElementById("banner").style.display = "block";
                                document.getElementById("banner").innerHTML = "User already exist!! Try signing in."
                                document.getElementById("banner").classList.add("error");
                                document.getElementById("sub").value = "Register"
                            } else {
                                document.getElementById("banner").style.backgroundColor = "red";
                                document.getElementById("banner").style.display = "block";
                                document.getElementById("banner").innerHTML = "Unexpected error occurred"
                                document.getElementById("banner").classList.add("error");
                                document.getElementById("sub").value = "Register"
                            }
                        })
                        .catch(err => {
                            document.getElementById("banner").style.backgroundColor = "red";
                            document.getElementById("banner").style.display = "block";
                            document.getElementById("banner").innerHTML = "It's on us! There was some error"
                            document.getElementById("banner").classList.add("error");
                            document.getElementById("sub").value = "Register"
                        })
                }
            })
        };</script>



</body>

</html>